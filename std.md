# Initiatives microservices backend

Backend du project **Initiatives** basé sur une architecture microservices.

## Présentation des différents micro-services applicatifs

### auth-service 
L'auth-service est un serveur d'autorisation. Il ne gère que la correspondance entre l'utilisateur et ses rôles.
Un endpoint est fourni afin de permettre l'authentification (voir swagger). Il prend en paramètre d'appel un token linkedin.
Celui-ci n'est utilisé que pour s'assurer que l'utilisateur est bien authentifié sur linkedIn. 
Cette vérification est effectuée via l'appel de l'url (api linkedIn) du profil de l'utilisateur. 
Cela permet de réccupérer son :
 - id
 - prénom
 - nom
 
### user-service 
Le user-service gère l'utilisateur fonctionnellement. Il expose une api REST pour cette resource.
Il est appelé également par l'auth-service pour :
 - demander l'ajout de l'adresse mail à l'utilisateur courant
 - demander la validation du code reçu par mail
 
## Séquence d'activation du compte


![diag-first-connexion](https://www.websequencediagrams.com/cgi-bin/cdraw?lz=dGl0bGUgUHJlbWnDqHJlIGNvbm5leGlvbgoKTW9iaWxlIC0-IFNTTyBwcm92aWRlciAoTGlua2VkSW4pOiBhdXRoZW50aWZpY2F0aW9uIAoAFBctPiAASQY6IHLDqWNjdXDDqXIALQZkJ3VuIGFjY2Vzc1Rva2UAbA1hdXRoLXNlcnZpY2U6IGRlbWFuZGUgZCcAaBAKAB0MAIEUHnBwZWwgdXJsIGR1IHByb2ZpbACBHBkAcBIAgSsRZSBsJ2lkLCBwcsOpbm9tIGV0IG5vbQB-EQAmIHMgaGFiaWxpdACCQQVzIApub3RlIG92ZXIAgXUOCkNvbnN0aXR1AIIwCnRva2VuIG91YXRoMiBhdmVjIAogICAtICB1c2VybmFtZQAIB2ZpcnN0TgAGCmxhAAINYXV0aG9yaXRpZXMKZW5kIG5vdGUAgkURAIM7CABtB2F1dGgyCgCBIQsAhCsHCiAgICBQYXMgZGUgcsO0bGUgZG9uYyBhZmZpY2hhZwAaBwCCNwXDqWNyYQCCQwVzYXNpZSBkZSBtYWlsAHkKAIN0GQCDQwZkdSBlbmRwb2ludAA_BmkAQQV1AEAGAIQGEHVzZXIAhEMMbGVnAIUxBmF1AA8NCgAdDAAnEmfDqW4AhTEOY29kZSBldCBlbnZvaSBkZSBjZWx1aS1jaSBwYXIAgUwGAEMQAIVNDgCEEx9ham91dCBkdQCCSAciSU5fVkFMSURBVElPTiIgw6AgbCd1dGlsaXNhdGV1ciBjb3VyYW50AIMpGACDHBhBAIMZCQCDDAwAgksIY29kZS4Ag1cFU2kAYQ9uAIJ0B3QgcGFzIGxlAIILBmltbcOpZGlhdGVtZW50LACEEgZsAIQMCHJldG91cm7DqQCBPhFwZXJtZQCDSwVkw6l0ZWN0ZXIAhE4GcXUAgmcGbXB0ZSBlc3QgY3LDqcOpIG1haXMgbm9uIGFjdGl2w6kAgSAGKD0-IGTDqWJyYW5jaAB-BSBkaXJlY3QgdmVycyBjZXQAgV8IYXByw6hzIHJlAIl1CSkAhEo4AIkcCHZhbGlkAIlaBwCCNQYAiRcNLT4AhFc1ACcQAFMTACEOAIgwDgB0DgCERR5VU0VSAIQzJy0-AItUCAoKCg&s=napkin)
<!-- https://www.websequencediagrams.com/?lz=dGl0bGUgUHJlbWnDqHJlIGNvbm5leGlvbgoKTW9iaWxlIC0-IFNTTyBwcm92aWRlciAoTGlua2VkSW4pOiBhdXRoZW50aWZpY2F0aW9uIAoAFBctPiAASQY6IHLDqWNjdXDDqXIALQZkJ3VuIGFjY2Vzc1Rva2UAbA1hdXRoLXNlcnZpY2U6IGRlbWFuZGUgZCcAaBAKAB0MAIEUHnBwZWwgdXJsIGR1IHByb2ZpbACBHBkAcBIAgSsRZSBsJ2lkLCBwcsOpbm9tIGV0IG5vbQB-EQAmIHMgaGFiaWxpdACCQQVzIApub3RlIG92ZXIAgXUOCkNvbnN0aXR1AIIwCnRva2VuIG91YXRoMiBhdmVjIAogICAtICB1c2VybmFtZQAIB2ZpcnN0TgAGCmxhAAINYXV0aG9yaXRpZXMKZW5kIG5vdGUAgkURAIM7CABtB2F1dGgyCgCBIQsAhCsHCiAgICBQYXMgZGUgcsO0bGUgZG9uYyBhZmZpY2hhZwAaBwCCNwXDqWNyYQCCQwVzYXNpZSBkZSBtYWlsAHkKAIN0GQCDQwZkdSBlbmRwb2ludAA_BmkAQQV1AEAGAIQGEHVzZXIAhEMMbGVnAIUxBmF1AA8NCgAdDAAnEmfDqW4AhTEOY29kZSBldCBlbnZvaSBkZSBjZWx1aS1jaSBwYXIAgUwGAEMQAIVNDgCEEx9ham91dCBkdQCCSAciSU5fVkFMSURBVElPTiIgw6AgbCd1dGlsaXNhdGV1ciBjb3VyYW50AIMpGACDHBhBAIMZCQCDDAwAgksIY29kZS4Ag1cFU2kAYQ9uAIJ0B3QgcGFzIGxlAIILBmltbcOpZGlhdGVtZW50LACEEgZsAIQMCHJldG91cm7DqQCBPhFwZXJtZQCDSwVkw6l0ZWN0ZXIAhE4GcXUAgmcGbXB0ZSBlc3QgY3LDqcOpIG1haXMgbm9uIGFjdGl2w6kAgSAGKD0-IGTDqWJyYW5jaAB-BSBkaXJlY3QgdmVycyBjZXQAgV8IYXByw6hzIHJlAIl1CSkAhEo4AIkcCHZhbGlkAIlaBwCCNQYAiRcNLT4AhFc1ACcQAFMTACEOAIgwDgB0DgCERR5VU0VSAIQzJy0-AItUCAoKCg&s=napkin -->

## A valider

Voir si la réponse à la validation du mail renvoie un nouveau token le nouveau rôle, si le mobile appelle directement 
par la suite le auth-service pour réauthentifier l'utilisateur automatiquement avec le token linkedin, 
ou bien si le mobile demande à l'utilisateur de se reconnecter pour accéder à l'application avec un compte actif.
